name: justin-os-surface
description: Surface Pro 7 variant with KDE and linux-surface kernel
base-image: ghcr.io/ublue-os/silverblue-main
image-version: 42

modules:
  # Add linux-surface repo FIRST
  - type: rpm-ostree
    repos:
      - https://pkg.surfacelinux.com/fedora/linux-surface.repo

  # Copy system files and home directory templates
  - type: files
    files:
      - source: system
        destination: /

  # Install RPM Fusion repositories with resilient mirror selection
  - type: script
    scripts:
      - install-rpmfusion-release.sh

  # Import shared modules
  - from-file: packages-surface.yml
  - from-file: surface-flatpaks.yml

  # Shared Microsoft font installation and shell configuration sequence
  - from-file: shared-fonts-shell.yml

  # Surface-specific packages
  - type: rpm-ostree
    install:
      - kernel-surface
      - kernel-surface-default-watchdog
      - iptsd
      - libwacom-surface
      - libwacom-surface-data
      - surface-secureboot
      - thermald
    remove:
      - kernel
      - kernel-core
      - kernel-modules
      - kernel-modules-core
      - kernel-modules-extra
      - libwacom
      - libwacom-data

  # Enable services
  - type: systemd
    system:
      enabled:
        - earlyoom.service
        - thermald.service
      masked:
        - systemd-oomd.service

  - type: signing
